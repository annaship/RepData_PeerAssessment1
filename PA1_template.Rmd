---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

```{r start}
knitr::opts_chunk$set(cache = TRUE)

library(readr)
library(magrittr)
library(ggplot2)
library(dplyr)
setwd("/Users/ashipunova/work/data_science_coursera/intro_r/RepData_PeerAssessment1/")
```

## Loading and preprocessing the data
```{r read.csv}
# unzip("sales.zip", list = TRUE)
activity_data <- readr::read_csv(unzip("activity.zip", "activity.csv"))

str(activity_data)
# transform(activity_data, date = ymd(date))

```


## What is mean total number of steps taken per day?

1. Calculate the total number of steps taken per day

```{r step_sums}
step_sums <- aggregate(steps ~ date, activity_data, sum, na.rm = T)
step_sums %>% head()
```

2. If you do not understand the difference between a histogram and a barplot, research the difference between them. Make a histogram of the total number of steps taken each day

```{r sum_hist}
sum_plot <- qplot(step_sums$steps, geom = "histogram", binwidth = 25000/5) 
print(sum_plot)
```

3. Calculate and report the mean and median of the total number of steps taken per day

```{r mean_and_med}
activity_data %>%
  group_by(date) %>%
  summarise(
    sum = sum(steps, na.rm = T), 
    mean = mean(steps, na.rm = T), 
    median = median(steps, na.rm = T)) -> mean_med

mean_med
# qplot(date, mean, data = mean_med)
#step_means_medians <- 
# qplot(date, steps, data = step_means, geom = "smooth")

```

## What is the average daily activity pattern?  

1. Make a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)

```{r interval.steps}
step_interv <- aggregate(steps ~ interval + date, activity_data, mean, na.rm = T)

plot(step_interv$interval, step_interv$steps, type = "l")

p_avg_activ = ggplot(data = step_interv, 
                     aes(x = interval,
                         y = steps, group = date)) +
              geom_line()
p_avg_activ

```

2. Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?

```{r max.steps}
step_interv[step_interv$steps == max(step_interv$steps), ]

```

## Imputing missing values

1. Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs)  

```{r miss_tot}
sapply(activity_data, function(x) sum(is.na(x)))

# NAs by day:
table(activity_data$date, is.na(activity_data$steps)) %>% head(3)

```

2. Devise a strategy for filling in all of the missing values in the dataset. The strategy does not need to be sophisticated. For example, you could use the mean/median for that day, or the mean for that 5-minute interval, etc.  

Imputing missing values using the mean for that 5-minute interval.  
```{r fill_in}
activity_data$step_imp <- ave(activity_data$steps, activity_data$interval, 
                          FUN = function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x))
# activity_data$step_imp %>% head
sapply(activity_data, function(x) sum(is.na(x)))

```

3. Create a new dataset that is equal to the original dataset but with the missing data filled in.  

```{r imputed_dataset}
activity_data %>% select(-c("steps")) %>%
  {.} -> imputed_dataset
  
#imputed_dataset %>% head

```

4. Make a histogram of the total number of steps taken each day and 

#```{r new_tot, ref.label=c('step_sums', 'sum_hist')}
#<<step_sums>>
#```

```{r new_tot}
imputed_dataset %>% head(3)
step_sums_imp <- aggregate(step_imp ~ date, imputed_dataset, sum, na.rm = T)
step_sums_imp %>% head(3)
sum_imp_plot <- qplot(step_sums$steps, geom = "histogram", binwidth = 25000/5) 
print(sum_plot)
```

Calculate and report the mean and median total number of steps taken per day.

```{r mean_med_imp}
imputed_dataset %>%
  group_by(date) %>%
  summarise(
    sum = sum(step_imp, na.rm = T), 
    mean = mean(step_imp, na.rm = T), 
    median = median(step_imp, na.rm = T)) %>%
#%T>% head(3) %>%
    {.} -> mean_med_imp

mean_med_imp
```

### Do these values differ from the estimates from the first part of the assignment? 
Yes

### What is the impact of imputing missing data on the estimates of the total daily number of steps?

```{r summ1}
summary(activity_data$steps)
```

```{r summ2}
summary(imputed_dataset$step_imp)
```

```{r summ3, echo=F}
# summary(mean_med_imp)
```

No impact

## Are there differences in activity patterns between weekdays and weekends?

For this part the weekdays() function may be of some help here. Use the dataset with the filled-in missing values for this part.

1. Create a new factor variable in the dataset with two levels – “weekday” and “weekend” indicating whether a given date is a weekday or weekend day. 

```{r week}
imputed_dataset$weekday <- weekdays(imputed_dataset$date, abbreviate = T)
weekends <- list("Sat", "Sun")
is_weekend = function(x) {
  x %in% weekends
}
imputed_dataset$is_weekend <- sapply(imputed_dataset$weekday, is_weekend)

imputed_dataset %>% head(3)
```

2. Make a panel plot containing a time series plot (i.e. \color{red}{\verb|type = "l"|}type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis). See the README file in the GitHub repository to see an example of what this plot should look like using simulated data.

